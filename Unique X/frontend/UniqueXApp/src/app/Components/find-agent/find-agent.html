<div class="bg-danger py-5 mb-5 text-white text-center shadow-sm" style="background: linear-gradient(45deg, #ef3341, #ab262f);">
  <div class="container">
    <h1 class="fw-bold mb-3 animate__animated animate__fadeInDown">Find the best real estate agents</h1>
    <!-- بار البحث -->
    <div class="col-md-6 mx-auto mt-4">
      <div class="input-group input-group-lg shadow-lg rounded-pill overflow-hidden bg-white">
        <span class="input-group-text bg-white border-0 ps-4"><i class="bi bi-search text-danger"></i></span>
        <input type="text" class="form-control border-0" placeholder="Enter agent name..." 
               [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event)">
      </div>
    </div>
  </div>
</div>

<div class="container pb-5">
  @if (isLoading()) {
    <div class="text-center py-5"><div class="spinner-border text-danger"></div></div>
  } @else {
    <div class="row g-4">
      @for (agent of filteredBrokers(); track agent.id) {
        <div class="col-lg-4 col-md-6 animate__animated animate__fadeInUp">
          <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden agent-card">
            <div class="card-body p-4 text-center">
              <div class="position-relative mb-4">
                <img [src]="agent.profileImageUrl || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" 
                     class="rounded-circle border border-4 border-white shadow-sm" 
                     style="width: 100px; height: 100px; object-fit: cover;">
              </div>
              
              <h5 class="fw-bold mb-1 text-dark">{{ agent.fullName }}</h5>
              <p class="text-muted small mb-4">Professional Real Estate Agent</p>
              
              <div class="bg-light p-3 rounded-3 d-flex justify-content-between align-items-center mb-4">
                <div class="text-start">
                  <small class="text-muted d-block small fw-bold">PROPERTIES</small>
                  <span class="fw-bold fs-5 text-danger">{{ agent.propertiesCount }}</span>
                </div>
                <i class="bi bi-houses fs-2 opacity-25"></i>
              </div>

              <!-- زرار عرض عقارات البروكر (هيوجهنا للهوم بفلتر الـ brokerId) -->
              <button class="btn btn-danger w-100 rounded-pill py-2 fw-bold shadow-sm"
                      [routerLink]="['/home']" [queryParams]="{ brokerId: agent.id }">
                View Properties
              </button>
            </div>
          </div>
        </div>
      } @empty {
        <div class="text-center py-5 w-100">
           <i class="bi bi-person-x fs-1 text-muted opacity-25"></i>
           <p class="text-muted">No agents found with this name.</p>
        </div>
      }
    </div>
  }
</div>