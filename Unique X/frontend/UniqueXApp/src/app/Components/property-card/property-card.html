<div class="card property-card border-0 shadow-sm h-100 mb-4 cursor-pointer" 
     [routerLink]="['/property-details', property.id]" 
     style="cursor: pointer;">
    <div class="position-relative">
    <!-- الصورة الرئيسية -->
    <img [src]="property.photos[0]?.url || 'assets/placeholder.jpg'" 
         class="card-img-top object-fit-cover" 
         style="height: 200px;" alt="Property Image">
    
    <div class="position-absolute top-0 start-0 m-3 d-flex flex-column gap-1" style="z-index: 5;">
      <!-- نوع المعاملة -->
      <span class="badge bg-danger rounded-pill px-3 py-2 shadow-sm">
        {{ property.listingType }}
      </span>

      <!-- حالة التسليم (Ready / Off) -->
      <span class="badge rounded-pill px-3 py-1 shadow-sm fw-bold text-uppercase"
            [class.bg-danger]="property.deliveryStatus === 'Ready'"
            [class.bg-secondary]="property.deliveryStatus !== 'Ready'"
            style="font-size: 0.65rem; width: fit-content;">
        <i class="bi" [class.bi-check-circle]="property.deliveryStatus === 'Ready'" 
                     [class.bi-clock]="property.deliveryStatus !== 'Ready'"></i>
        {{ property.deliveryStatus === 'Ready' ? 'Ready' : 'Off' }}
      </span>
    </div>

    @if (authService.loggedIn() && authService.getUserType() === 0) {
  <button class="btn btn-light rounded-circle position-absolute top-0 end-0 m-2 shadow-sm border-0 wishlist-btn"
          (click)="onToggleWishlist($event)" 
          style="z-index: 10; width: 38px; height: 38px; display: flex; align-items: center; justify-content: center; background: white;">
    
    <i class="bi fs-5" 
       [class.bi-heart-fill]="isLiked" 
       [class.bi-heart]="!isLiked"
       [class.text-danger]="isLiked"
       [style.color]="!isLiked ? '#adb5bd' : ''">
    </i>
  </button>
}

    
  </div>

  <div class="card-body">
    <div class="mb-2">
        <span class="badge bg-primary-subtle text-primary border border-primary-subtle rounded-pill px-3 py-1 fw-bold" 
              style="font-size: 0.7rem; letter-spacing: 0.5px;">
          <i class="bi bi-building me-1"></i> {{ property.propertyType }}
        </span>
    </div>
    <h4 class="fw-bold text-dark mb-1"> {{ property.title }}</h4>
    @if (property.projectName) {
      <p class="text-danger fw-bold small mb-1 animate__animated animate__fadeIn">
        <i class="bi bi-building-fill-check me-1"></i> {{ property.projectName }}
      </p>
    }
    <!-- السعر (بالخط العريض - Signature Style) -->
    <h6 class=" text-dark mb-1">EGP {{ property.price | number }}</h6>
    <!-- العنوان -->
    <p class="text-truncate text-muted small mb-2">
      <i class="bi bi-geo-alt-fill text-danger me-1"></i>
       {{ property.region }}, {{ property.city }}
    </p>

    <!-- التفاصيل (الأيقونات) -->
    <div class="d-flex justify-content-between border-top pt-3 text-muted small">
      <span><i class="bi bi-door-open me-1"></i> {{ property.rooms }} Beds</span>
      <span><i class="bi bi-droplet me-1"></i> {{ property.bathrooms }} Baths</span>
      <span><i class="bi bi-aspect-ratio me-1"></i> {{ property.area }} m²</span>
    </div>
    <br>
    <br>
    <div class="mt-auto">
      <a [href]="getWhatsAppLink(property.brokerPhone, property.code)" 
         target="_blank"
         (click)="$event.stopPropagation()"
         class="btn btn-success w-100 rounded-pill fw-bold py-2 shadow-sm d-flex align-items-center justify-content-center">
        
        <i class="bi bi-whatsapp me-2 fs-5"></i> WhatsApp
      </a>
    </div>
  </div>
</div>