<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
        
        <!-- الهيدر الملون -->
        <div class="bg-danger d-flex align-items-center justify-content-center" style="height: 140px;">
             
        </div>
        
        <div class="card-body pt-0 px-4 px-md-5 pb-5">
          <!-- قسم الصورة والاسم -->
          <div class="text-center position-relative" style="margin-top: -70px;">
            <div class="position-relative d-inline-block">
              <!-- عرض الصورة الشخصية -->
              <img [src]="userData()?.profileImageUrl || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" 
                   class="rounded-circle border border-5 border-white shadow-sm" 
                   style="width: 140px; height: 140px; object-fit: cover; background: white;">
              
              <!-- زرار تغيير الصورة -->
              <label for="profileUpload" class="btn btn-dark btn-sm rounded-circle position-absolute bottom-0 end-0 shadow" 
                     style="width: 38px; height: 38px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 3px solid white;">
                <i class="bi bi-camera-fill"></i>
                <input type="file" id="profileUpload" class="d-none" (change)="onImageChange($event)" accept="image/*">
              </label>
            </div>
            
            <h3 class="fw-bold mt-3 mb-0">{{ userData()?.firstName }} {{ userData()?.lastName }}</h3>
            
          </div>

          <!-- قسم الإحصائيات (الديناميكي حسب نوع المستخدم) -->
          <div class="row justify-content-center mt-4">
            <div class="col-md-5 col-8">
              <div class="stat-card p-3 rounded-4 bg-white shadow-sm border border-light text-center transition-all">
                
                @if (userData()?.userType === 1) {
                  <!-- إحصائية البروكر -->
                  <div class="icon-box bg-danger-subtle text-danger rounded-circle mx-auto mb-2" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">
                    <i class="bi bi-houses-fill fs-4"></i>
                  </div>
                  <h4 class="fw-bold mb-0 text-dark">{{ userData()?.totalProperties }}</h4>
                  <small class="text-muted fw-bold text-uppercase" style="font-size: 0.7rem;">Properties Listed</small>
                } @else {
                  <!-- إحصائية الكلاينت -->
                  <div class="icon-box bg-primary-subtle text-primary rounded-circle mx-auto mb-2" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">
                    <i class="bi bi-heart-fill fs-4"></i>
                  </div>
                  <h4 class="fw-bold mb-0 text-dark">{{ userData()?.totalWishlist }}</h4>
                  <small class="text-muted fw-bold text-uppercase" style="font-size: 0.7rem;">Saved in Wishlist</small>
                }

              </div>
            </div>
          </div>

          <!-- فورم تعديل البيانات -->
          <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="mt-5 border-top pt-5">
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label class="form-label small fw-bold text-secondary">First Name</label>
                <input type="text" formControlName="firstName" class="form-control form-control-lg bg-light border-0 shadow-sm rounded-3">
              </div>
              <div class="col-md-6">
                <label class="form-label small fw-bold text-secondary">Last Name</label>
                <input type="text" formControlName="lastName" class="form-control form-control-lg bg-light border-0 shadow-sm rounded-3">
              </div>
            </div>

            <div class="mb-4">
              <label class="form-label small fw-bold text-secondary">Email Address</label>
              <div class="input-group">
                <span class="input-group-text border-0 bg-light shadow-sm"><i class="bi bi-envelope text-muted"></i></span>
                <input type="email" formControlName="email" class="form-control form-control-lg border-0 bg-light shadow-sm" readonly>
              </div>
              <small class="text-muted" style="font-size: 0.7rem;">Email address cannot be changed for security reasons.</small>
            </div>

            <div class="mb-5">
              <label class="form-label small fw-bold text-secondary">Phone Number</label>
              <div class="input-group">
                <span class="input-group-text border-0 bg-light shadow-sm"><i class="bi bi-phone text-muted"></i></span>
                <input type="text" formControlName="phoneNumber" class="form-control form-control-lg border-0 bg-light shadow-sm">
              </div>
            </div>

            <!-- زر التحديث -->
            <div class="d-grid">
              <button type="submit" [disabled]="profileForm.invalid" class="btn btn-danger btn-lg rounded-pill fw-bold py-3 shadow transition-all hover-lift">
                 <i class="bi bi-save2 me-2"></i> Save Profile Changes
              </button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>